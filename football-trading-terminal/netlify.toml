[build]
  command = "npm install && npm run build"
  publish = "dist"

[build.environment]
  NODE_VERSION = "20"
  NPM_FLAGS = "--legacy-peer-deps"

# ============================================
# API Proxy Rules - MUST be before catch-all
# Proxy to API-Football with API key from env
# ============================================

# Live odds: /api/football/odds?fixture=xxx&live=true → /odds/live?fixture=xxx
[[redirects]]
  from = "/api/football/odds-live"
  to = "https://v3.football.api-sports.io/odds/live"
  status = 200
  force = true
  [redirects.headers]
    x-apisports-key = "${FOOTBALL_API_KEY}"

# Pre-match odds: /api/football/odds?fixture=xxx → /odds?fixture=xxx
[[redirects]]
  from = "/api/football/odds-prematch"
  to = "https://v3.football.api-sports.io/odds"
  status = 200
  force = true
  [redirects.headers]
    x-apisports-key = "${FOOTBALL_API_KEY}"

# Live fixtures
[[redirects]]
  from = "/api/football/fixtures-live"
  to = "https://v3.football.api-sports.io/fixtures?live=all"
  status = 200
  force = true
  [redirects.headers]
    x-apisports-key = "${FOOTBALL_API_KEY}"

# Fixture by ID (with statistics)
[[redirects]]
  from = "/api/football/fixture/:id"
  to = "https://v3.football.api-sports.io/fixtures?id=:id"
  status = 200
  force = true
  [redirects.headers]
    x-apisports-key = "${FOOTBALL_API_KEY}"

# Statistics
[[redirects]]
  from = "/api/football/statistics/:id"
  to = "https://v3.football.api-sports.io/fixtures/statistics?fixture=:id"
  status = 200
  force = true
  [redirects.headers]
    x-apisports-key = "${FOOTBALL_API_KEY}"

# Events
[[redirects]]
  from = "/api/football/events/:id"
  to = "https://v3.football.api-sports.io/fixtures/events?fixture=:id"
  status = 200
  force = true
  [redirects.headers]
    x-apisports-key = "${FOOTBALL_API_KEY}"

# Lineups
[[redirects]]
  from = "/api/football/lineups/:id"
  to = "https://v3.football.api-sports.io/fixtures/lineups?fixture=:id"
  status = 200
  force = true
  [redirects.headers]
    x-apisports-key = "${FOOTBALL_API_KEY}"

# Health check
[[redirects]]
  from = "/api/health"
  to = "https://v3.football.api-sports.io/status"
  status = 200
  force = true
  [redirects.headers]
    x-apisports-key = "${FOOTBALL_API_KEY}"

# SPA catch-all (MUST be last)
[[redirects]]
  from = "/*"
  to = "/index.html"
  status = 200
